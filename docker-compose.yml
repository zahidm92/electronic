version: '3.8'

services:
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"

  product-service:
    build:
      context: .
      dockerfile: src/product-service/Dockerfile
    ports:
      - "3550:3550"
    environment:
      - PORT=3550

  cart-service:
    build:
      context: .
      dockerfile: src/cart-service/Dockerfile
    ports:
      - "7070:7070"
    environment:
      - PORT=7070
      - REDIS_ADDR=redis:6379
    depends_on:
      - redis

  currency-service:
    build:
      context: .
      dockerfile: src/currency-service/Dockerfile
    ports:
      - "7000:7000"
    environment:
      - PORT=7000

  shipping-service:
    build:
      context: .
      dockerfile: src/shipping-service/Dockerfile
    ports:
      - "50051:50051"
    environment:
      - PORT=50051

  payment-service:
    build:
      context: .
      dockerfile: src/payment-service/Dockerfile
    ports:
      - "50052:50051"
    environment:
      - PORT=50051

  checkout-service:
    build:
      context: .
      dockerfile: src/checkout-service/Dockerfile
    ports:
      - "5050:5050"
    environment:
      - PORT=5050
      - PRODUCT_SERVICE_ADDR=product-service:3550
      - CART_SERVICE_ADDR=cart-service:7070
      - SHIPPING_SERVICE_ADDR=shipping-service:50051
      - PAYMENT_SERVICE_ADDR=payment-service:50051
      - CURRENCY_SERVICE_ADDR=currency-service:7000
    depends_on:
      - product-service
      - cart-service
      - shipping-service
      - payment-service
      - currency-service

  ad-service:
    build:
      context: .
      dockerfile: src/ad-service/Dockerfile
    ports:
      - "9555:9555"
    environment:
      - PORT=9555

  email-service:
    build:
      context: .
      dockerfile: src/email-service/Dockerfile
    ports:
      - "8082:8080"
    environment:
      - PORT=8080

  recommendation-service:
    build:
      context: .
      dockerfile: src/recommendation-service/Dockerfile
    ports:
      - "8081:8080"
    environment:
      - PORT=8080

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - PRODUCT_SERVICE_ADDR=product-service:3550
      - CART_SERVICE_ADDR=cart-service:7070
      - CURRENCY_SERVICE_ADDR=currency-service:7000
      - CHECKOUT_SERVICE_ADDR=checkout-service:5050
      - AD_SERVICE_ADDR=ad-service:9555
      - RECOMMENDATION_SERVICE_ADDR=recommendation-service:8080
    depends_on:
      - product-service
      - cart-service
      - currency-service
      - checkout-service
      - ad-service
      - recommendation-service
